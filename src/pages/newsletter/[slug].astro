---
import Layout from '../../layouts/Layout.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  // Only get newsletter articles
  const newsletters = await getCollection('articles', ({ data }) => data.type === 'newsletter');

  // Sort by date to get issue numbers (oldest = 001)
  const sorted = newsletters.sort((a, b) =>
    new Date(a.data.date).getTime() - new Date(b.data.date).getTime()
  );

  return sorted.map((newsletter, index) => ({
    params: { slug: newsletter.slug },
    props: {
      newsletter,
      issueNumber: String(index + 1).padStart(3, '0')
    },
  }));
}

const { newsletter, issueNumber } = Astro.props;
const { Content } = await render(newsletter);

// Format date
const formattedDate = newsletter.data.date.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});
---

<Layout
  title={`${newsletter.data.title} - Approachable Design`}
  description={newsletter.data.description}
  ogImage={newsletter.data.image}
  variant="light"
  article={{ publishedDate: newsletter.data.date }}
>
  <article class="py-16 md:py-24">
    <div class="container">
      <div class="max-w-3xl mx-auto">
        <!-- Header -->
        <header class="mb-12">
          <span class="text-brand-purple text-sm font-medium uppercase tracking-wider">
            Newsletter Issue #{issueNumber}
          </span>
          <h1 class="text-center text-balance font-display text-3xl md:text-5xl font-bold mt-4 mb-6 text-brand-dark">
            {newsletter.data.title}
          </h1>
          <p class="text-brand-dark/60">
            {formattedDate}
          </p>
        </header>

        <!-- Featured Image -->
        {newsletter.data.image && (
          <img
            src={newsletter.data.image}
            alt={newsletter.data.title}
            class="w-full rounded-2xl mb-12"
          />
        )}

        <!-- Content -->
        <div class="prose prose-light">
          <Content />
        </div>

        <!-- Back link -->
        <div class="mt-16 pt-8 border-t border-brand-dark/10">
          <a href="/newsletter/archive" class="text-brand-purple hover:underline">
            &larr; Back to newsletter archive
          </a>
        </div>
      </div>
    </div>
  </article>
</Layout>

<style>
  .prose-light {
    color: #0B0A16;
  }
  .prose-light :global(p) {
    color: rgba(11, 10, 22, 0.8);
  }
  .prose-light :global(strong) {
    color: #0B0A16;
  }
  .prose-light :global(h1),
  .prose-light :global(h2),
  .prose-light :global(h3) {
    color: #0B0A16;
  }
  .prose-light :global(ul li),
  .prose-light :global(ol li) {
    color: rgba(11, 10, 22, 0.8);
  }
  .prose-light :global(a) {
    color: #5148CA;
  }
  .prose-light :global(blockquote) {
    color: rgba(11, 10, 22, 0.7);
    border-left-color: #5148CA;
  }
</style>
