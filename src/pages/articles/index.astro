---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

// Get blog articles only (not newsletter) and sort by date
const articles = await getCollection('articles', ({ data }) => data.type !== 'newsletter');
const sortedArticles = articles.sort((a, b) =>
  new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

// Get featured article (explicitly marked, or fall back to most recent)
const featuredArticle = sortedArticles.find(a => a.data.featured) || sortedArticles[0];
const remainingArticles = sortedArticles.filter(a => a.slug !== featuredArticle?.slug);
---

<Layout title="Blog - Approachable Design" description="Design tips, tutorials, and insights for non-designers and solopreneurs." variant="light">
  <section class="py-16 md:py-24">
    <div class="container">
      <!-- Hero -->
      <div class="text-center mb-16">
        <h1 class="text-center text-balance font-display-black-italic text-5xl md:text-6xl lg:text-7xl mb-4 text-brand-dark">
          Design resources for<br />non-designers
        </h1>
        <p class="text-lg text-brand-dark/60 max-w-xl mx-auto">
          Tutorials, videos, and articles for creators, brand owners and visual storytellers.
        </p>
      </div>

      <!-- Featured Article -->
      {featuredArticle && (
        <div class="mb-20">
          <a href={`/articles/${featuredArticle.slug}`} class="group block">
            <div class="md:flex items-center gap-8">
              {featuredArticle.data.image && (
                <div class="md:w-1/2 mb-6 md:mb-0">
                  <img
                    src={featuredArticle.data.image}
                    alt={featuredArticle.data.title}
                    class="w-full rounded-2xl"
                  />
                </div>
              )}
              <div class="md:w-1/2">
                <span class="inline-block bg-brand-dark text-white text-xs font-semibold uppercase tracking-wider px-3 py-1 rounded-full mb-4">
                  Featured
                </span>
                <h2 class="font-heading font-bold text-2xl md:text-3xl mb-4 text-brand-dark group-hover:text-brand-purple transition-colors">
                  {featuredArticle.data.title}
                </h2>
                <p class="text-brand-dark/60 mb-6">{featuredArticle.data.description}</p>
                <span class="inline-flex items-center gap-2 bg-brand-dark text-white font-medium px-5 py-2.5 rounded-full group-hover:bg-brand-purple transition-colors">
                  Read the Article <span>&rarr;</span>
                </span>
              </div>
            </div>
          </a>
        </div>
      )}

      <!-- All Articles -->
      <h2 class="font-heading font-bold text-sm uppercase tracking-wider text-brand-dark/50 mb-8">All Articles</h2>

      {remainingArticles.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-12">
          {remainingArticles.map((article) => (
            <a href={`/articles/${article.slug}`} class="group block">
              {article.data.image && (
                <img
                  src={article.data.image}
                  alt={article.data.title}
                  class="w-full aspect-[4/3] object-cover rounded-xl mb-4"
                />
              )}
              {article.data.category && (
                <span class="inline-block bg-brand-dark/10 text-brand-dark text-xs font-semibold uppercase tracking-wider px-3 py-1 rounded mb-2">
                  {article.data.category.replace('-', ' ')}
                </span>
              )}
              <h3 class="font-heading font-bold text-xl mb-2 text-brand-purple">
                {article.data.title}
              </h3>
              <span class="text-brand-purple text-sm font-bold inline-flex items-center gap-2">
                Read the Article
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M6.3 2.84A1.5 1.5 0 004 4.11v11.78a1.5 1.5 0 002.3 1.27l9.344-5.891a1.5 1.5 0 000-2.538L6.3 2.84z" />
                </svg>
              </span>
            </a>
          ))}
        </div>
      ) : (
        <div class="text-center py-16">
          <p class="text-brand-dark/60 text-lg mb-4">No articles yet.</p>
          <p class="text-brand-dark/40">Check back soon for design tips and tutorials!</p>
        </div>
      )}
    </div>
  </section>
</Layout>
